<!DOCTYPE html>


<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Bringing up Cycle-accurate models of RISC-V cores &mdash; Bringing up Cycle-accurate models of RISC-V cores</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/styles.css" type="text/css" />
    <link rel="stylesheet" href="_static/single.css" type="text/css" />
    
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2017.09.07',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/common.js"></script>
    
    <script type="text/javascript" src="_static/slides.js"></script>
    <script type="text/javascript" src="_static/sync.js"></script>
    <script type="text/javascript" src="_static/controller.js"></script>
    <script type="text/javascript" src="_static/init.js"></script>
    
    
    <link rel="top" title="Bringing up Cycle-accurate models of RISC-V cores" href="#" /> 
  </head>
  <body>

<section
   id="slide_container"
   class='slides layout-regular'>


  
<article class="slide level-1" id="bringing-up-cycle-accurate-models-of-risc-v-cores">

<h1>Bringing up Cycle-accurate models of RISC-V cores</h1>

<p>Graham Markall</p>
<p>Compiler Engineer, <a class="reference external" href="http://www.embecosm.com/">Embecosm</a></p>
<p><a class="reference external" href="mailto:graham&#46;markall&#37;&#52;&#48;embecosm&#46;com">graham<span>&#46;</span>markall<span>&#64;</span>embecosm<span>&#46;</span>com</a></p>
<p>Twitter: <a class="reference external" href="https://twitter.com/gmarkall">&#64;gmarkall</a></p>



<div class="slide-no">1</div>


</article>
<article class="slide level-2" id="a-short-story">

<h2>A Short Story</h2>

<ul class="simple">
<li>Plot: Going from project idea fully-working system</li>
<li>Focus here on RISC-V ecosystem and experience</li>
<li>Survey</li>
<li>Software toolchain</li>
<li>Simulation / Testing</li>
<li>Benchmarking</li>
<li>Conclusion: <strong>success</strong></li>
</ul>



<div class="slide-no">2</div>


</article>
<article class="slide level-2" id="requirements-overview">

<h2>Requirements Overview</h2>

<ul class="simple">
<li>RV32 / bare metal</li>
<li>Easily extensible</li>
<li>Relatively small</li>
<li>Relatively fast</li>
<li>Open source</li>
</ul>



<div class="slide-no">3</div>


</article>
<article class="slide level-2" id="initial-survey-1-11">

<h2>Initial Survey (1-11)</h2>

<ul class="simple">
<li>ASTC Systems</li>
<li>Bluespec</li>
<li>Clarvi - Simon Moore / Rob Mullins, Cambridge University</li>
<li>Codasip</li>
<li>f32c</li>
<li>lowRISC - lowRISC not-for-profit / Cambridge University</li>
<li>mriscv - OnchipUIS / Ckristian Duran</li>
<li>Orca - VectorBlox</li>
<li>Phalanx - Jan Gray / GRVI</li>
<li>PicoRV32 - Clifford Wolf</li>
<li>RI5CY - PuLP Platform / ETHZ</li>
</ul>



<div class="slide-no">4</div>


</article>
<article class="slide level-2" id="initial-survey-12-20">

<h2>Initial Survey (12-20)</h2>

<ul class="simple">
<li>River - GNSS Sensor</li>
<li>Rocket - Free Chips Project / UCB-Bar</li>
<li>Shakti - IIT Madras</li>
<li>Sodor - UC Berkeley / Christopher Celio</li>
<li>Tom Thumb - Maik Merten</li>
<li>TurboRav - Sebastian Boe</li>
<li>uRV - CERN / Tomasz Wlostowski</li>
<li>Yarvi - Tommy Thorn</li>
<li>Z-Scale - UC Berkeley / Yunsup Lee, Albert Ou, Albert Magyar</li>
</ul>



<div class="slide-no">5</div>


</article>
<article class="slide level-2" id="interesting-cores">

<h2>Interesting Cores</h2>

<ul class="simple">
<li>PicoRV32</li>
<li>RI5CY</li>
<li>Rocket Chip Generator</li>
</ul>



<div class="slide-no">6</div>


</article>
<article class="slide level-2" id="picorv32-clifford-wolf">

<h2>PicoRV32 - Clifford Wolf</h2>

<ul class="simple">
<li><a class="reference external" href="https://github.com/cliffordwolf/picorv32">https://github.com/cliffordwolf/picorv32</a></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Requirement</th>
<th class="head">Assessment</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>RV32</td>
<td>Yes (RV32IMC)</td>
</tr>
<tr class="row-odd"><td>Easily extensible</td>
<td>Yes, + PCPI</td>
</tr>
<tr class="row-even"><td>Relatively small</td>
<td>Yes (750-1K LUTs / 397 PLBs)</td>
</tr>
<tr class="row-odd"><td>Relatively fast</td>
<td>Yes (400-700MHz on Xilinx 7-series)</td>
</tr>
<tr class="row-even"><td>Open source</td>
<td>Yes</td>
</tr>
</tbody>
</table>



<div class="slide-no">7</div>


</article>
<article class="slide level-2" id="ri5cy-pulp-platform">

<h2>RI5CY - PuLP Platform</h2>

<ul class="simple">
<li><a class="reference external" href="https://github.com/pulp-platform/riscv">https://github.com/pulp-platform/riscv</a></li>
<li><a class="reference external" href="http://www.pulp-platform.org/wp-content/uploads/2017/08/ri5cy_user_manual.pdf">http://www.pulp-platform.org/wp-content/uploads/2017/08/ri5cy_user_manual.pdf</a></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Requirement</th>
<th class="head">Assessment</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>RV32</td>
<td>Yes (RV32IMC + F + Xpulp)</td>
</tr>
<tr class="row-odd"><td>Easily extensible</td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>Relatively small</td>
<td>&quot;Yes&quot;</td>
</tr>
<tr class="row-odd"><td>Relatively fast</td>
<td>? (50-75MHz on Zynq)</td>
</tr>
<tr class="row-even"><td>Open source</td>
<td>Yes</td>
</tr>
</tbody>
</table>



<div class="slide-no">8</div>


</article>
<article class="slide level-2" id="rocket-chip-generator">

<h2>Rocket Chip Generator</h2>

<ul class="simple">
<li><a class="reference external" href="https://github.com/freechipsproject/rocket-chip">https://github.com/freechipsproject/rocket-chip</a></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Requirement</th>
<th class="head">Assessment</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>RV32</td>
<td>Yes (RV32/64 Various)</td>
</tr>
<tr class="row-odd"><td>Easily extensible</td>
<td>No (Scala + CHISEL)</td>
</tr>
<tr class="row-even"><td>Relatively small</td>
<td>Possibly not</td>
</tr>
<tr class="row-odd"><td>Relatively fast</td>
<td>?</td>
</tr>
<tr class="row-even"><td>Open source</td>
<td>Yes</td>
</tr>
</tbody>
</table>



<div class="slide-no">9</div>


</article>
<article class="slide level-2" id="toolchain-implementation">

<h2>Toolchain implementation</h2>

<p>GNU Toolchain for bare metal. Upstream snapshots:</p>
<ul class="simple">
<li>Binutils</li>
<li>GCC</li>
<li>GDB</li>
<li>Newlib</li>
</ul>
<p>Other repos:</p>
<ul class="simple">
<li>PicoRV32 + Verilator model + testbench</li>
<li>RI5CY + Verilator model + testbench</li>
<li>GDBServer incorporating models</li>
</ul>



<div class="slide-no">10</div>


</article>
<article class="slide level-2" id="toolchain-customisations">

<h2>Toolchain customisations</h2>

<p>Bare metal, so:</p>
<ul class="simple">
<li>Set SP in <code class="code docutils literal"><span class="pre">_start</span></code>. 4 byte aligned, then 16 bytes</li>
<li>I/O - GDBServer implements hosted I/O</li>
<li>Syscall implementation in GDBServer</li>
<li>Add interrupt vector table for RI5CY</li>
</ul>



<div class="slide-no">11</div>


</article>
<article class="slide level-2" id="other-points">

<h2>Other Points</h2>

<ul class="simple">
<li>Still link libgloss</li>
<li>riscv32-unknown-elf naming</li>
<li>PicoRV32 quite straightforward</li>
<li>RI5CY always starts at boot address</li>
<li>Not all SystemVerilog supported by Verilator</li>
<li>RI5CY memory interface - trial and error</li>
</ul>



<div class="slide-no">12</div>


</article>
<article class="slide level-2" id="testing">

<h2>Testing</h2>

<ul class="simple">
<li>RISC-V ISA Test suite</li>
<li>GCC test suite</li>
</ul>



<div class="slide-no">13</div>


</article>
<article class="slide level-2" id="picorv32-gcc-testsuite">

<h2>PicoRV32 GCC Testsuite</h2>

<table border="1" class="docutils">
<colgroup>
<col width="84%" />
<col width="16%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Outcome</th>
<th class="head">Count</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Expected passes</td>
<td>86143</td>
</tr>
<tr class="row-odd"><td>Unexpected failures</td>
<td>530</td>
</tr>
<tr class="row-even"><td>Unexpected successes</td>
<td>4</td>
</tr>
<tr class="row-odd"><td>Expected failures</td>
<td>147</td>
</tr>
<tr class="row-even"><td>Unresolved testcases</td>
<td>124</td>
</tr>
<tr class="row-odd"><td>Unsupported tests</td>
<td>2540</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Fails: Unimplemented I/O</li>
<li>Unresolved: timeout too short</li>
</ul>



<div class="slide-no">14</div>


</article>
<article class="slide level-2" id="ri5cy-gcc-testsuite">

<h2>RI5CY GCC Testsuite</h2>

<table border="1" class="docutils">
<colgroup>
<col width="84%" />
<col width="16%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Outcome</th>
<th class="head">Count</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Expected passes</td>
<td>86842</td>
</tr>
<tr class="row-odd"><td>Unexpected failures</td>
<td>27</td>
</tr>
<tr class="row-even"><td>Unexpected successes</td>
<td>4</td>
</tr>
<tr class="row-odd"><td>Expected failures</td>
<td>147</td>
</tr>
<tr class="row-even"><td>Unresolved testcases</td>
<td>189</td>
</tr>
<tr class="row-odd"><td>Unsupported tests</td>
<td>2540</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Fails: ctor/dtor, fence, RAM, libunwind, hosted env, upstream</li>
<li>Unresolved: timeout too short. Down to 7 with more time.</li>
</ul>



<div class="slide-no">15</div>


</article>
<article class="slide level-2" id="beebs-bristol-embecosm-embedded-benchmark-suite">

<h2>BEEBS: Bristol / Embecosm Embedded Benchmark Suite</h2>

<ul class="simple">
<li>81 benchmarks from WCET, MiBench, DSPStone</li>
<li>Chosen to show the energy consumption of embedded devices</li>
<li>ARM (STM32), AVR (ATMega328 / 256), X86</li>
<li><a class="reference external" href="http://mageec.org/">Machine-Guided Energy-Efficient Compilation (MAGEEC)</a></li>
<li>Small, no I/O needed (start / stop triggers)</li>
</ul>



<div class="slide-no">16</div>


</article>
<article class="slide level-2" id="discarded-benchmarks">

<h2>Discarded Benchmarks</h2>

<ul class="simple">
<li>Mostly timeouts</li>
<li>1 or 2 self-check issues</li>
<li>Self-check issues consistent between PicoRV32 and RI5CY</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>crc32</td>
<td>rijndael</td>
</tr>
<tr class="row-even"><td>cubic</td>
<td>sglib-arraysort</td>
</tr>
<tr class="row-odd"><td>fdct</td>
<td>sqrt</td>
</tr>
<tr class="row-even"><td>matmult</td>
<td>trio</td>
</tr>
<tr class="row-odd"><td>nbody</td>
<td>whetstone</td>
</tr>
<tr class="row-even"><td>nettle-md5</td>
<td>wikisort</td>
</tr>
</tbody>
</table>



<div class="slide-no">17</div>


</article>
<article class="slide level-2" id="cycle-count-ratio">

<h2>Cycle count ratio</h2>

<ul class="simple">
<li>See accompanying file, <a class="reference external" href="https://github.com/gmarkall/tutorials/blob/master/orconf-2017/benchmark_data.ods?raw=true">benchmark.ods</a></li>
<li>Ratio of PicoRV32 cycle count : RI5CY cycle count</li>
<li>Mean: 4</li>
</ul>
<img alt="_images/corecomparison.png" src="_images/corecomparison.png" />



<div class="slide-no">18</div>


</article>
<article class="slide level-2" id="conclusions">

<h2>Conclusions</h2>

<ul class="simple">
<li>Moving forward with RI5CY core</li>
<li>Cycle accurate models + toolchain up and running</li>
<li>RISC-V Ecosystem provided for our needs with low effort</li>
<li>Building models + toolchain, replicating results:</li>
<li><a class="reference external" href="https://github.com/embecosm/riscv-toolchain/tree/orconf">https://github.com/embecosm/riscv-toolchain/tree/orconf</a></li>
<li>See README.md</li>
<li><a class="reference external" href="http://www.embecosm.com/2017/08/29/compiler-engineers-wanted-2/">Embecosm is hiring</a>!</li>
</ul>



<div class="slide-no">19</div>


</article>

</section>

<section id="slide_notes">

</section>

  </body>
</html>